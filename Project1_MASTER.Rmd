---
title: 'Project #1'
author: "Kenneth Andrysiak, Joel Revo, Alec Palo, Jacob Cohen, Michael McLaughlan"
date: "2/10/2021"
output: 
  html_document: 
    code_folding: hide
    number_sections: true 
    toc: true
    toc_float: 
      collapsed: true  
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Introduction 
A number of different variables in the data seem to have relevant business takeaways. In this section, we will analyze these relationships and provide visualizations of the relationships between the variables.

To begin, we will do some basic descriptive analytics on a number of different variables that we think have some pretty significant business insights.

## Data Import and Basic Sturcture Visualization

```{r}
hotel<-read.csv("hotel_bookings.csv")
library(ggplot2)
```

## Data Cleaning

```{r}
hotel$arrival_date_year<-as.factor(hotel$arrival_date_year)
hotel$arrival_date_month<-as.factor(hotel$arrival_date_month)
hotel$arrival_date_day_of_month<-as.factor(hotel$arrival_date_day_of_month)
hotel$arrival_date_week_number<-as.factor(hotel$arrival_date_week_number)
hotel$is_repeated_guest<-as.factor(hotel$is_repeated_guest)
```

```{r}
hotel$meal<-as.factor(hotel$meal)
hotel$country<-as.factor(hotel$country)
hotel$market_segment<-as.factor(hotel$market_segment)
hotel$distribution_channel<-as.factor(hotel$distribution_channel)
hotel$reserved_room_type<-as.factor(hotel$reserved_room_type)
hotel$assigned_room_type<-as.factor(hotel$assigned_room_type)
hotel$deposit_type<-as.factor(hotel$deposit_type)
hotel$agent<-as.factor(hotel$agent)
hotel$company<-as.factor(hotel$company)
hotel$customer_type<-as.factor(hotel$customer_type)
hotel$reservation_status<-as.factor(hotel$reservation_status)
hotel$reservation_status_date<-as.factor(hotel$reservation_status_date)
```

## Basic Data Visualization
```{r}
summary(hotel)
str(hotel)
```

Here, we cleaned the data to turn a number of different variables in the data set into factors to make the data easier to work with. 

# Cancelation 

We are focusing on cancellations, because they, logically, have an impact on revenue. We will analyze its connection to other variables in the data we were provided and answer questions that will give insight into how the business should operate moving forward.

## What proportion of reservations are being canceled?
```{r}
tableis_canceled<-table(hotel$is_canceled)
round(prop.table(tableis_canceled),3)
```
What we see here is that roughly 63% of all of the reservations weren't canceled and the other 37% were. What does that mean for us? Well, it gives us context on how many bookings we can list to the public to maximize our revenue with the expectation that people will cancel their reservations. This will allow us to work at optimal capacity and improve efficiency.

## How many of each hotel classification (Resort and City) is being canceled, and at what proportion?
### Number of Resort Hotels Canceled
```{r}
resort<-hotel[hotel$hotel == "Resort Hotel",]
city<-hotel[hotel$hotel == "City Hotel",]
resortcanceled<-hotel[hotel$hotel == "Resort Hotel" & hotel$is_canceled == 1,]
cityiscanceled<-hotel[hotel$hotel == "City Hotel" & hotel$is_canceled == 1,]
nrow(resortcanceled)
```

### Number of City Hotels Canceled
```{r}
nrow(cityiscanceled)
```

### Proportion of Resort Hotels Canceled

```{r}
round(nrow(resortcanceled)/nrow(resort),3)
```

### Proportion of City Hotels Canceled
```{r}
round(nrow(cityiscanceled)/nrow(city),3)
```

### Number of Reservations Canceled by Hotel Classification
```{r}
ggplot(hotel, aes(x=is_canceled, fill = hotel)) + geom_bar() +scale_x_continuous(breaks = seq(0,1))  
```
This graph illustrates the idea presented above in our comments on the cancellation rate. It gives us more context on how many room reservations we should be listing at either hotel classification. We see roughly 41.7% of City Hotels are canceled, compared to 27.8% in Resort Hotels, which tells us that we should be listing more bookings at City hotels to drive revenue.

## Which country of origin had the highest cancelation rate?
```{r}
canceled<-hotel[hotel$is_canceled == 1,]
countrycanceled<-aggregate(hotel$is_canceled, list(Country=hotel$country), mean)

```
The purpose of answering this question was to get a sense of the different markets that we should be focusing on moving forward, while also learning how to target those markets strategically. 

## What was the average price paid for reservations that were canceled compared to those that weren't? 
```{r}
avgadris_canceled<-tapply(hotel$adr, hotel$is_canceled, mean)
avgadris_canceled
ggplot(hotel, aes(x=adr)) +geom_histogram(binwidth = 25) +xlim(0,350) 
```


## What was the average price paid by those in resort hotels, and those in city hotels? Did this have any effect on the cancellation rate of each of the classifications?
```{r}
avgadrhotel<-tapply(hotel$adr, hotel$hotel, mean)
avgadrhotel
summary(avgadrhotel)
```


## Which booking channel had the most cancellations, and by hotel classification?
```{r}
aggregate(hotel$is_canceled, list(hotel=hotel$hotel, DistributionChannel=hotel$distribution_channel), mean)
```

## How many previous cancellations repeated, and by hotel classification?
```{r}
canceledagain<-ifelse(hotel$is_canceled == hotel$previous_cancellations, 1, 0)
sum(canceledagain)
notcanceledagain<-ifelse(hotel$is_canceled != hotel$previous_bookings_not_canceled, 1, 0)
sum(notcanceledagain)
avgadragain<-tapply(hotel$adr,canceledagain, mean, na.rm = TRUE)
avgadrnot<-tapply(hotel$adr, notcanceledagain, mean, na.rm = TRUE)
avgadragain
avgadrnot
ggplot(hotel, aes(x=canceledagain, fill = hotel)) + geom_bar() +scale_x_continuous(breaks = seq(0,1)) 
```

## What was the average number of changes made to the bookings in those bookings that were canceled? What about those that weren't, and by hotel classification?
```{r}
avgchangecanceled<-tapply(hotel$is_canceled, hotel$booking_changes, mean, na.rm = TRUE)
avgchangecanceled
avgchangenot<-tapply(ifelse(hotel$is_canceled == 1, 0,1), hotel$booking_changes, mean, na.rm = TRUE)
avgchangenot
```
It doesn't seem as if the number of changes in the 

## Did the deposit type have any effect on the chance of cancelation? By hotel classification?
```{r}
deposittypecanceled<-aggregate(hotel$is_canceled, list(DepositType=hotel$deposit_type, Hoteltype=hotel$hotel), mean)
deposittypecanceled
```


# Group Size, Length of Stay, and Type
In this section we will be analyzing the impact of size of group, type of group, and length of stay on different variable such as adr, and number of speical requests. Since adr is directly related to the amount of revenue we will recieve, it is the key variable analyzed in this section. However, we also look at number of special requests, since it is likely that a higher number of special requests impacts the costs for the hotel, thus making a customer less profitable. 

## Group Stay Duration 
```{r}
totalnights<-hotel$stays_in_week_nights+hotel$stays_in_weekend_nights

totalnights <- as.factor(totalnights)

plot(totalnights,ylab="Number of Reservations", xlab="Number of Nights Stayed", main="Number of nights Stayed per Reservation", col="purple")

round(mean(hotel$stays_in_week_nights)+mean(hotel$stays_in_weekend_nights),2)
median(hotel$stays_in_week_nights+hotel$stays_in_weekend_nights)
```
Here we can see the average number of nights stayed by hotel guests. First, we combine stays in weeknights with stays during the weekend to obtain total nights per visit. The plot shows that a majority of guests are staying between 1 to 5 days, with the average being 3.43 nights, and the median being 3 nights. This is substantially higher than the national average stay of about 1.8 days (Business Travel News)
## Stay Duration vs. ADR
```{r}
staydurationadr<-aggregate(adr ~ totalnights, data=hotel, mean, na.rm=TRUE)

staydurationadr

```

## Group Size
Here, we are looking to find data related to group size. Since the current data has people grouped into three different columns (adults, children and babies) we will first create a variable to look at the total number of people per group. From this, we will look to compare group size to other vairables. 
```{r}


groupsize <-hotel$adults+hotel$children+hotel$babies

groupsize <- as.factor(groupsize)

plot(groupsize, ylab="Number of Reservations", xlab="People in Reservation", main="Group Size per Reservation",col="purple")

mean(hotel$adults+hotel$children+hotel$babies, na.rm = TRUE)
median(hotel$adults+hotel$children+hotel$babies, na.rm = TRUE)


```
Here we combine the adults, children, and babies to find the total group size. On average, reservations contain slightly fewer than 2 people. 


## Group Size Impact on ADR
```{r}
groupsizeadr<-aggregate(adr ~ groupsize, data=hotel, mean, na.rm=TRUE)

groupsizeadr

```
More importantly than just group size, we analyzed the impact of group size on ADR. Here we can see adr increase with group size up to 5 people. Although we don't have data on number of rooms reserved (if more than one) We can see that once the group size is greater than two, revenue per night increases substantially. If in the same number of rooms, the costs also likely do not increase much with added people. 

## Market Segment Group Type vs. ADR
Here were looking at groups by market segment. 
```{r}
library(ggplot2)

ggplot(hotel, aes(x=groupsize, fill=market_segment, main= "Number of Reservations by Group size and Market Segment")) + geom_bar(position = "stack")

marketsegmentadr<-aggregate(adr ~ market_segment, data=hotel, mean, na.rm=TRUE)


plot(hotel$market_segment, main="Number of Reservations by Market Segment", las=2, col="purple")



marketsegmentadr

```
From the above graphs and information, we can see that group size doesn't have a noticiable impact on the market segment that books a reservation. More interestingly though, is looking at the data regarding which market segments book most frequently, and the average ADR of those segments. Online TA and Offline TA TO are the most frequently used booking methods, however, Online is more than $30 higher per day in ADR than offline booking (see table). This might suggest that the Hotel should shift towards exclusively online booking, as it is possible the room disocount are higher for offline booking. 

## Kids Impact on Special Requests 
Here, we will look to see if number of children + babies is related to the number of special requests, as we suspect that a higher number of special requests will lead to larger costs for the hotel.  
```{r}

mean(hotel$total_of_special_requests, na.rm=TRUE)

groupswithoutkids<-hotel[hotel$babies ==0 & hotel$children ==0,] #Groups with no kids
groupswithkids <- hotel[hotel$babies> 0 | hotel$children> 0,] #Groups with at least 1 child or baby

mean(groupswithkids$total_of_special_requests, na.rm=TRUE)

mean(groupswithoutkids$total_of_special_requests, na.rm = TRUE)




```

```{r}
hotel$TotalKids <- hotel$babies + hotel$children
lm_kidsSpecReq <- lm(total_of_special_requests ~ TotalKids, data = hotel)
summary(lm_kidsSpecReq)

#ggplot(data = hotel) + geom_point(mapping = aes(TotalKids, total_of_special_requests))
ggplot(data = hotel) + geom_bar(mapping = aes(TotalKids, main = "Bar Plot of Total Number of Kids"))
```

```{r}
ggplot(data=hotel) + geom_point(mapping = aes(x=TotalKids, y=adr))
```
```


Here we can see very interesting results that confirm our hypothesis. First, the average number of special requests for all reservations is .57. However, groups with children or babies almost average double that number at .927 per reservation while groups without any children or babies average only .54 special requests. 
## Kids Impact on Special Requests and ADR
```{r}
groupswithkids <- hotel[hotel$adults>=2 & hotel$babies> 0 | hotel$children> 0, ]

groupswithadults <- hotel[hotel$adults>=3,]

mean(groupswithadults$adr)

mean(groupswithkids$adr, na.rm=TRUE) 
```
In addition, we wanted to check if groups with kids are spending more money on average (to potentially cancelout the cost of more special requests). However, from these results we can see that the adr of groups with children and babies and the adr of groups with just adults is roughly the same. This means that groups with kids are much more costly to the hotel without driving additional revenue. 

## Extra to Fuck around with if neccesary 
```{r}

ggplot(hotel, 
       aes(x = arrival_date_month, 
           y =mean(adr))) +
  geom_bar(stat = "identity")

```

# Jacob Code -Not sure about header

## Average Price Per Person 
```{r}
priceperperson<-hotel$adr*groupsize


```

## Avg Daily Rate by Type of Hotel
```{r}
mean(hotel$adr[hotel$hotel == "Resort Hotel"]) # avg daily rate for resort hotel
mean(hotel$adr[hotel$hotel == "City Hotel"]) # avg daily rate for resort hotel
```


## Does the type of hotel influence number of car parking spaces?

Not sure how deep this could go but this would more so be relevant for hotels maximizing their space. How many parking spaces should they have / could they utilize spare space another way?
```{r}
summary(hotel$required_car_parking_spaces) # Summary statistics

ZeroParkingSpaces <- hotel[hotel$required_car_parking_spaces == "0",] # Filter for guests with 0 parking spaces
nrow(ZeroParkingSpaces) # Give total number of guests with 0 parking spaces)

SomeParkingSpaces <- hotel[hotel$required_car_parking_spaces > "0",] # Filter for guests with 1+ parking spaces
nrow(SomeParkingSpaces) # Give total number of guests with 1+ parking spaces)

ZeroParkingSpacesCity <- hotel[hotel$required_car_parking_spaces == "0" & hotel$hotel == "City Hotel",] # Filter for guests at city hotel requiring 1+ parking spaces
SomeParkingSpacesCity <- hotel[hotel$required_car_parking_spaces > "0" & hotel$hotel == "City Hotel",] # Filter for guests at city hotel requiring 1+ parking spaces

ZeroParkingSpacesResort <- hotel[hotel$required_car_parking_spaces == "0" & hotel$hotel == "Resort Hotel",] # Filter for guests at resort hotel requiring 1+ parking spaces
SomeParkingSpacesResort <- hotel[hotel$required_car_parking_spaces > "0" & hotel$hotel == "Resort Hotel",] # Filter for guests at resort hotel requiring 1+ parking spaces

nrow(ZeroParkingSpacesCity) # Number of guests at city hotels requiring zero parking spaces
nrow(SomeParkingSpacesCity) # Number of guests at city hotels requiring 1+ parking spaces

nrow(ZeroParkingSpacesResort) # Number of guests at resort hotels requiring zero parking spaces
nrow(SomeParkingSpacesResort) # Number of guests at resort hotels requiring 1+ parking spaces

nrow(ZeroParkingSpacesCity) / nrow(hotel) # Proportion of guests at city hotels requiring parking spaces
nrow(ZeroParkingSpacesResort) / nrow(hotel) # Proportion of guests at resort hotels requiring parking spaces

ggplot(data=hotel) + geom_bar(mapping = aes(required_car_parking_spaces, fill = hotel)) # visual of parking spaces by hotel type
```
<br/> Update: I'm not overly interested in exploring the number of required parking spaces anymore. The **vast** majority of hotel guests require 0 parking spaces (which makes sense -- they're on vacation after all).


## Does the time of year influence the number of special requests?

```{r}
#MonthsTable <- hotel[hotel$arrival_date_month == "OO",] # Filter for flights with airline code OO
#nrow(code_OO) # Give total number of flights with airline code OO

SpecReqByMonth <- aggregate(hotel$total_of_special_requests, list(Month=hotel$arrival_date_month), mean) # Avg SpecReq by month
SpecReqByMonth
round(sort(SpecReqByMonth[,2], decreasing = T),2) # Need help keeping the month labels when I sort

ggplot(data = hotel) + geom_bar(mapping = aes(arrival_date_month, fill = "red"))
```


## Is there a linear relationship between avg daily rate and special requests

```{r}
lm_SpecReq_ADR <- lm(adr ~ total_of_special_requests, data=hotel) # create linear model b/w special requests and adr
summary(lm_SpecReq_ADR)
```

```{r}
ggplot(data = hotel) + geom_point(mapping = aes(total_of_special_requests, adr))
```


## Relationship between reservation status and demographics of guests (aduls/children/babies, country)

```{r}

```

# Time of Year 
## Do Holidays impact ADR? 
```{r}
mean(hotel$adr) #Find Adr on average



tableJuly4 = hotel[hotel$arrival_date_month == "July" & hotel$arrival_date_day_of_month== 3 | hotel$arrival_date_day_of_month==4,] #Create Table to isolate specifc columns that we want

round(mean(tableJuly4$adr, na.rm= TRUE),2) #Find mean for that holiday 


tablenewyearseve = hotel[hotel$arrival_date_month == "December" & hotel$arrival_date_day_of_month== 31,]
round(mean(tablenewyearseve$adr, na.rm= TRUE),2) #repeat

tableXmas = hotel[hotel$arrival_date_month == "December" & hotel$arrival_date_day_of_month== 24 | hotel$arrival_date_day_of_month==25,]
round(mean(tableXmas$adr, na.rm= TRUE),2)

tableValentines = hotel[hotel$arrival_date_month == "February" & hotel$arrival_date_day_of_month== 13 | hotel$arrival_date_day_of_month==14,]
round(mean(tableValentines$adr, na.rm= TRUE),2)

```
From the above information we have pretty interesting findings. When we look at the average ADR across the entire year, and compare that to the ADR for reservations during the Holidays, we see that the Hotel is actually charging the same price or lower for most holidays. Some of the typically most expensive holidays to travel (July 4th, Xmas, Valentines) have roughly the same ADR as the overall average. Only the ADR for New Years is higher, but only by 29%, whereas some hotes raise prices by as much as 100% during busy holidays. 

## Does Resort type impact ADR on holidays?

```{r}
tableResort = hotel[hotel$hotel == "Resort Hotel",] #Here we are doing the same code as above, but also isolation for type of hotel to identify whether this is a hotel specifc problem 
mean(tableResort$adr)

tableJuly4Resort = hotel[hotel$arrival_date_month == "July" & hotel$arrival_date_day_of_month== 3 | hotel$arrival_date_day_of_month==4 & hotel$hotel== "Resort Hotel",]

round(mean(tableJuly4Resort$adr, na.rm= TRUE),2)
tableCity = hotel[hotel$hotel == "City Hotel",]
mean(tableCity$adr)

tableJuly4City = hotel[hotel$arrival_date_month == "July" & hotel$arrival_date_day_of_month== 3 | hotel$arrival_date_day_of_month==4 & hotel$hotel== "City Hotel",]

round(mean(tableJuly4City$adr, na.rm= TRUE),2)


```
```{r}
tableXmasCity = hotel[hotel$arrival_date_month == "December" & hotel$arrival_date_day_of_month== 24 | hotel$arrival_date_day_of_month==25 & hotel$hotel=="City Hotel",]
round(mean(tableXmasCity$adr, na.rm= TRUE),2)


TableXmasResort = hotel[hotel$arrival_date_month == "December" & hotel$arrival_date_day_of_month== 24 | hotel$arrival_date_day_of_month==25 & hotel$hotel=="Resort Hotel",]
round(mean(TableXmasResort$adr, na.rm= TRUE),2)


```
From the above information we can also see that the problem is not hotel specifc. Both City and Resort hotels charge roughly the same ADR overall throughout the year as they do on a few key holidays (shown here are Christmas and July 4th)

# Type of Client 
## Which clients have the highest adr? 
## Which clients have the most special requests?
## Which clients have the highest cancellation rate 

# Summary

*adr*: average daily rate as defined by dividing the sum of all lodging transactions by the total number of staying nights
*required_car_parking_spaces*: number of car parking spaces required by the customer
*total_of_special_requests*: number of special requests made by the customer (e.g. twin bed or high floor)
*reservation_status*: reservation last status, assuming one of three categories: Canceled – booking was canceled by the customer; Check-Out – customer has checked in but already departed; No-Show – customer did not check-in and did inform the hotel of the reason why
*reservation_status_date*: date at which the last status was set. This variable can be used in conjunction with the ReservationStatus to understand when was the booking canceled or when did the customer checked-out of the hotel



```{r}
summary(hotel$adr)
summary(hotel$required_car_parking_spaces)
summary(hotel$total_of_special_requests)
summary(hotel$reservation_status)
```
